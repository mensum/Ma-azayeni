<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Depo QR Okuyucu Pro</title>

<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #f4f7f6;
  padding: 15px;
  text-align: center;
  color: #333;
}

#reader {
  max-width: 400px;
  margin: 20px auto;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  background: white;
}

#urun {
  display: none;
  background: #fff;
  margin: 20px auto;
  max-width: 400px;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.1);
  text-align: left;
}

.row {
  display: flex;
  justify-content: space-between;
  padding: 12px 0;
  border-bottom: 1px solid #eee;
}

.row:last-child { border-bottom: none; }

.row b { color: #555; font-size: 0.85em; text-transform: uppercase; }
.row span { color: #2c3e50; font-weight: 700; }

#feedback {
  margin-top: 15px;
  padding: 10px;
  border-radius: 8px;
  font-weight: bold;
}

.status-ok { color: #27ae60; background: #eafaf1; }
.status-err { color: #c0392b; background: #fdf2f2; }

.btn-reset {
  width: 100%;
  margin-top: 20px;
  padding: 12px;
  background: #3498db;
  color: white;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  transition: background 0.3s;
}
.btn-reset:hover { background: #2980b9; }
</style>
</head>
<body>

<h2>ğŸ“¦ Depo Stok Kontrol</h2>
<p style="color: #7f8c8d;">QR Kodunu veya Barkodu TaratÄ±n</p>

<div id="reader"></div>
<div id="feedback"></div>

<div id="urun">
  <div class="row"><b>ÃœrÃ¼n / Marka</b><span id="marka"></span></div>
  <div class="row"><b>Renk</b><span id="renk"></span></div>
  <div class="row"><b>Beden</b><span id="beden"></span></div>
  <div class="row"><b>Raf Konumu</b><span id="raf" style="color:#e67e22;"></span></div>
  <div class="row"><b>Stok Adedi</b><span id="stok"></span></div>
  
  <button class="btn-reset" onclick="location.reload()">Yeni Tarama Yap</button>
</div>

<script>
const html5QrCode = new Html5Qrcode("reader");
const config = { fps: 15, qrbox: { width: 250, height: 250 } };

// Kamera BaÅŸlatma
html5QrCode.start(
  { facingMode: "environment" }, 
  config,
  onScanSuccess
).catch(err => {
  document.getElementById("feedback").innerText = "Kamera HatasÄ±: " + err;
  document.getElementById("feedback").className = "status-err";
});

function onScanSuccess(decodedText) {
  if (navigator.vibrate) navigator.vibrate(100);
  
  const feedbackBox = document.getElementById("feedback");
  const urunPanel = document.getElementById("urun");
  
  try {
    // QR iÃ§eriÄŸi JSON formatÄ±nda mÄ±?
    if (decodedText.startsWith("{")) {
      const data = JSON.parse(decodedText);
      
      // JSON iÃ§indeki 'raf' anahtarÄ±nÄ± veya benzerlerini kontrol et
      document.getElementById("marka").innerText = data.marka || data.urun || "TanÄ±msÄ±z";
      document.getElementById("renk").innerText = data.renk || "-";
      document.getElementById("beden").innerText = data.beden || "-";
      document.getElementById("raf").innerText = data.raf || data.konum || "Raf Bilgisi Yok";
      document.getElementById("stok").innerText = data.stok || "0";
      
      feedbackBox.innerText = "âœ… Veri BaÅŸarÄ±yla AlÄ±ndÄ±";
    } else {
      // DÃ¼z barkod/metin ise raf bilgisini boÅŸ bÄ±rakma, "DÃ¼z Barkod" olarak belirt
      document.getElementById("marka").innerText = decodedText;
      document.getElementById("renk").innerText = "-";
      document.getElementById("beden").innerText = "-";
      document.getElementById("raf").innerText = "Bilinmiyor (DÃ¼z Barkod)";
      document.getElementById("stok").innerText = "-";
      
      feedbackBox.innerText = "â„¹ï¸ DÃ¼z Barkod Okundu";
    }
    
    feedbackBox.className = "status-ok";
    urunPanel.style.display = "block";
    
    // Okuma baÅŸarÄ±lÄ± olduktan sonra kamerayÄ± durdur (isteÄŸe baÄŸlÄ±)
    html5QrCode.stop(); 

  } catch (e) {
    feedbackBox.innerText = "âŒ Hata: QR Kod formatÄ± hatalÄ±!";
    feedbackBox.className = "status-err";
    console.error(e);
  }
}
</script>

</body>
</html>
